name: Initialize

on:
  workflow_dispatch:

defaults:
  run:
    shell: pwsh

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
    steps:
      - uses: actions/checkout@v3
      - name: Copy PS modules to an existing entry of PSModulePath
        run: |
          $destinationPath = ($env:PSModulePath -split [IO.Path]::PathSeparator)[0]
          foreach ($modulePath in (Get-ChildItem "${{ github.workspace }}" -Recurse -Include "*.psm1"))
          {
            New-Item -ItemType Directory -Path $destinationPath -Name $modulePath.Directory.Name
            Copy-Item $modulePath -Destination (Join-Path -Path $destinationPath -ChildPath $modulePath.Directory.Name)
          }
      - name: Test
        run: |
          Get-Help Get-AzureWebAppWrapper
